<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>s3 input
        | Filebeat Reference [7.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Filebeat Reference [7.x]" /><link rel="up" href="configuration-filebeat-options.html" title="Configure inputs" /><link rel="prev" href="filebeat-input-syslog.html" title="Syslog input" /><link rel="next" href="filebeat-input-netflow.html" title="NetFlow input" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Filebeat/Reference/7.x" /><meta name="DC.subject" content="Filebeat" /><meta name="DC.identifier" content="7.x" /></head><body><div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Filebeat Reference
      [7.x]
    </a></span> » <span class="breadcrumb-link"><a href="configuring-howto-filebeat.html">Configuring Filebeat</a></span> » <span class="breadcrumb-link"><a href="configuration-filebeat-options.html">Configure inputs</a></span> » <span class="breadcrumb-node">s3 input</span></div><div class="navheader"><span class="prev"><a href="filebeat-input-syslog.html">
              « 
              Syslog input</a>
           
        </span><span class="next">
           
          <a href="filebeat-input-netflow.html">NetFlow input
               »
            </a></span></div><div class="xpack section"><div class="titlepage"><div><div><h2 class="title"><a id="filebeat-input-s3"></a>s3 input<a href="https://github.com/elastic/beats/edit/7.x/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p></div></div><p>Use the <code class="literal">s3</code> input to retrieve logs from S3 objects that are pointed by messages
from specific SQS queues. This input can, for example, be used to receive S3
server access logs to monitor detailed records for the requests that are made to
a bucket.</p><p>When processing a s3 object which pointed by a sqs message, if half of the set
visibility timeout passed and the processing is still ongoing, then the
visibility timeout of that sqs message will be reset to make sure the message
does not go back to the queue in the middle of the processing. If there are
errors happening during the processing of the s3 object, then the process will be
stopped and the sqs message will be returned back to the queue.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: s3
  queue_url: https://sqs.ap-southeast-1.amazonaws.com/1234/test-s3-queue
  access_key_id: my-access-key
  secret_access_key: my-secret-access-key</pre></div><p>The <code class="literal">s3</code> input supports the following configuration options plus the
<a class="xref" href="filebeat-input-s3.html#filebeat-input-s3-common-options" title="Common options">Common options</a> described later.</p><h4><a id="_literal_queue_url_literal"></a><code class="literal">queue_url</code><a href="https://github.com/elastic/beats/edit/7.x/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>URL of the AWS SQS queue that messages will be received from. Required.</p><h4><a id="_literal_visibility_timeout_literal"></a><code class="literal">visibility_timeout</code><a href="https://github.com/elastic/beats/edit/7.x/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The duration (in seconds) that the received messages are hidden from subsequent
retrieve requests after being retrieved by a ReceiveMessage request.
This value needs to be a lot bigger than filebeat collection frequency so
if it took too long to read the s3 log, this sqs message will not be reprocessed.
The default visibility timeout for a message is 300 seconds. The minimum
is 0 seconds. The maximum is 12 hours.</p><h4><a id="_literal_aws_credentials_literal"></a><code class="literal">aws credentials</code><a href="https://github.com/elastic/beats/edit/7.x/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In order to make AWS API calls, <code class="literal">s3</code> input requires AWS credentials.Please see
 <a class="link" href="filebeat-input-s3.html#aws-credentials-config" title="AWS Credentials Configuration">AWS credentials options</a> for more details.</p><h3><a id="_s3_and_sqs_setup"></a>S3 and SQS setup<a href="https://github.com/elastic/beats/edit/7.x/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Enable bucket notification: any new object creation in S3 bucket will also
create a notification through SQS. Please see
<a class="ulink" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ways-to-add-notification-config-to-bucket.html#step1-create-sqs-queue-for-notification" target="_top">create-sqs-queue-for-notification</a>
for more details.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="filebeat-input-s3-common-options"></a>Common options<a href="https://github.com/elastic/beats/edit/7.x/filebeat/docs/inputs/input-common-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The following configuration options are supported by all inputs.</p><h5><a id="_literal_enabled_literal_10"></a><code class="literal">enabled</code><a href="https://github.com/elastic/beats/edit/7.x/filebeat/docs/inputs/input-common-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Use the <code class="literal">enabled</code> option to enable and disable inputs. By default, enabled is
set to true.</p><h5><a id="_literal_tags_literal_10"></a><code class="literal">tags</code><a href="https://github.com/elastic/beats/edit/7.x/filebeat/docs/inputs/input-common-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>A list of tags that Filebeat includes in the <code class="literal">tags</code> field of each published
event. Tags make it easy to select specific events in Kibana or apply
conditional filtering in Logstash. These tags will be appended to the list of
tags specified in the general configuration.</p><p>Example:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: s3
  . . .
  tags: ["json"]</pre></div><h5><a id="filebeat-input-s3-fields"></a><code class="literal">fields</code><a href="https://github.com/elastic/beats/edit/7.x/filebeat/docs/inputs/input-common-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Optional fields that you can specify to add additional information to the
output. For example, you might add fields that you can use for filtering log
data. Fields can be scalar values, arrays, dictionaries, or any nested
combination of these. By default, the fields that you specify here will be
grouped under a <code class="literal">fields</code> sub-dictionary in the output document. To store the
custom fields as top-level fields, set the <code class="literal">fields_under_root</code> option to true.
If a duplicate field is declared in the general configuration, then its value
will be overwritten by the value declared here.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: s3
  . . .
  fields:
    app_id: query_engine_12</pre></div><h5><a id="fields-under-root-s3"></a><code class="literal">fields_under_root</code><a href="https://github.com/elastic/beats/edit/7.x/filebeat/docs/inputs/input-common-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>If this option is set to true, the custom
<a class="link" href="filebeat-input-s3.html#filebeat-input-s3-fields" title="fields">fields</a> are stored as top-level fields in
the output document instead of being grouped under a <code class="literal">fields</code> sub-dictionary. If
the custom field names conflict with other field names added by Filebeat,
then the custom fields overwrite the other fields.</p><h5><a id="_literal_processors_literal_10"></a><code class="literal">processors</code><a href="https://github.com/elastic/beats/edit/7.x/filebeat/docs/inputs/input-common-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>A list of processors to apply to the input data.</p><p>See <a class="xref" href="filtering-and-enhancing-data.html" title="Filter and enhance the exported data"><em>Filter and enhance the exported data</em></a> for information about specifying
processors in your config.</p><h5><a id="_literal_pipeline_literal_10"></a><code class="literal">pipeline</code><a href="https://github.com/elastic/beats/edit/7.x/filebeat/docs/inputs/input-common-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The Ingest Node pipeline ID to set for the events generated by this input.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The pipeline ID can also be configured in the Elasticsearch output, but
this option usually results in simpler configuration files. If the pipeline is
configured both in the input and output, the option from the
input is used.</p></div></div><h3><a id="aws-credentials-config"></a>AWS Credentials Configuration<a href="https://github.com/elastic/beats/edit/7.x/x-pack/libbeat/docs/aws-credentials-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To configure AWS credentials, either put the credentials into the Filebeat configuration, or use a shared credentials file, as shown in the following examples.</p><h4><a id="_supported_formats"></a>Supported Formats<a href="https://github.com/elastic/beats/edit/7.x/x-pack/libbeat/docs/aws-credentials-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Use <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code> and/or <code class="literal">AWS_SESSION_TOKEN</code>
</li></ul></div><p>Users can either put the credentials into metricbeat module configuration or use
environment variable <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code> and/or
<code class="literal">AWS_SESSION_TOKEN</code> instead.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
Use AWS credentials in Filebeat configuration
</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: s3
  queue_url: https://sqs.us-east-1.amazonaws.com/123/test-queue
  access_key_id: '&lt;access_key_id&gt;'
  secret_access_key: '&lt;secret_access_key&gt;'
  session_token: '&lt;session_token&gt;'</pre></div><p class="simpara">or</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: s3
  queue_url: https://sqs.us-east-1.amazonaws.com/123/test-queue
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'</pre></div></li><li class="listitem"><p class="simpara">
Use shared AWS credentials file
</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: s3
  queue_url: https://sqs.us-east-1.amazonaws.com/123/test-queue
  credential_profile_name: test-fb</pre></div></li></ul></div><p><code class="literal">credential_profile_name</code> is optional. If there is no <code class="literal">credential_profile_name</code>
given, the default profile will be used.
In Windows, shared credentials file is at <code class="literal">C:\Users\&lt;yourUserName&gt;\.aws\credentials</code>.
For Linux, macOS or Unix, the file is located at <code class="literal">~/.aws/credentials</code>. Please see
<a class="ulink" href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/create-shared-credentials-file.html" target="_top">Create Shared Credentials File</a>
for more details.</p><h4><a id="_aws_credentials_types"></a>AWS Credentials Types<a href="https://github.com/elastic/beats/edit/7.x/x-pack/libbeat/docs/aws-credentials-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>There are two different types of AWS credentials can be used:
access keys and temporary security credentials.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Access keys
</li></ul></div><p><code class="literal">AWS_ACCESS_KEY_ID</code> and <code class="literal">AWS_SECRET_ACCESS_KEY</code> are the two parts of access keys.
They are long-term credentials for an IAM user or the AWS account root user.
Please see
<a class="ulink" href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" target="_top">AWS Access Keys
 and Secret Access Keys</a>
for more details.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Temporary security credentials
</li></ul></div><p>temporary security credentials has a limited lifetime and consists of an
access key ID, a secret access key, and a security token which typically returned
from <code class="literal">GetSessionToken</code>. MFA-enabled IAM users would need to submit an MFA code
while calling <code class="literal">GetSessionToken</code>. <code class="literal">default_region</code> identifies the AWS Region
whose servers you want to send your first API request to by default. This is
typically the Region closest to you, but it can be any Region. Please see
<a class="ulink" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" target="_top">Temporary Security Credentials</a>
for more details.
<code class="literal">sts get-session-token</code> AWS CLI can be used to generate temporary credentials. For example. with MFA-enabled:</p><pre class="screen">aws&gt; sts get-session-token --serial-number arn:aws:iam::1234:mfa/your-email@example.com --token-code 456789 --duration-seconds 129600</pre><p>Because temporary security credentials are short term, after they expire, the user needs to generate new ones and modify
the aws.yml config file with the new credentials. Unless <a class="ulink" href="https://www.elastic.co/guide/en/beats/metricbeat/current/_live_reloading.html" target="_top">live reloading</a>
feature is enabled for Metricbeat, the user needs to manually restart Metricbeat after updating the config file in order
to continue collecting Cloudwatch metrics. This will cause data loss if the config file is not updated with new
credentials before the old ones expire. For Metricbeat, we recommend users to use access keys in config file to enable
aws module making AWS api calls without have to generate new temporary credentials and update the config frequently.</p><p>IAM policy is an entity that defines permissions to an object within your AWS environment. Specific permissions needs
to be added into the IAM user’s policy to authorize Metricbeat to collect AWS monitoring metrics. Please see documentation
under each metricset for required permissions.</p></div></div><div class="navfooter"><span class="prev"><a href="filebeat-input-syslog.html">
              « 
              Syslog input</a>
           
        </span><span class="next">
           
          <a href="filebeat-input-netflow.html">NetFlow input
               »
            </a></span></div></body></html>
