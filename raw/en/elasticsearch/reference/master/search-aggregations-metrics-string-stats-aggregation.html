<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>String Stats Aggregation | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="search-aggregations-metrics.html" title="Metrics Aggregations"/>
<link rel="prev" href="search-aggregations-metrics-scripted-metric-aggregation.html" title="Scripted Metric Aggregation"/>
<link rel="next" href="search-aggregations-metrics-sum-aggregation.html" title="Sum Aggregation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span>
»
<span class="breadcrumb-link"><a href="search-aggregations-metrics.html">Metrics Aggregations</a></span>
»
<span class="breadcrumb-node">String Stats Aggregation</span>
</div>
<div class="navheader">
<span class="prev">
<a href="search-aggregations-metrics-scripted-metric-aggregation.html">« Scripted Metric Aggregation</a>
</span>
<span class="next">
<a href="search-aggregations-metrics-sum-aggregation.html">Sum Aggregation »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-aggregations-metrics-string-stats-aggregation"></a>String Stats Aggregation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/metrics/string-stats-aggregation.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>A <code class="literal">multi-value</code> metrics aggregation that computes statistics over string values extracted from the aggregated documents.
These values can be retrieved either from specific <code class="literal">keyword</code> fields in the documents or can be generated by a provided script.</p>
<p>The string stats aggregation returns the following results:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">count</code> - The number of non-empty fields counted.
</li>
<li class="listitem">
<code class="literal">min_length</code> - The length of the shortest term.
</li>
<li class="listitem">
<code class="literal">max_length</code> - The length of the longest term.
</li>
<li class="listitem">
<code class="literal">avg_length</code> - The average length computed over all terms.
</li>
<li class="listitem">
<code class="literal">entropy</code> - The <a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)" class="ulink" target="_top">Shannon Entropy</a> value computed over all terms collected by
the aggregation. Shannon entropy quantifies the amount of information contained in the field. It is a very useful metric for
measuring a wide range of properties of a data set, such as diversity, similarity, randomness etc.
</li>
</ul>
</div>
<p>Assuming the data consists of a twitter messages:</p>
<a id="5507b01f713674781996a07718785444"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /twitter/_search?size=0
{
    "aggs" : {
        "message_stats" : { "string_stats" : { "field" : "message.keyword" } }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/386.console"></div>
<p>The above aggregation computes the string statistics for the <code class="literal">message</code> field in all documents. The aggregation type
is <code class="literal">string_stats</code> and the <code class="literal">field</code> parameter defines the field of the documents the stats will be computed on.
The above will return the following:</p>
<a id="5f196374e1b1e008eca06b7d35ad496b"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
    ...

    "aggregations": {
        "message_stats" : {
            "count" : 5,
            "min_length" : 24,
            "max_length" : 30,
            "avg_length" : 28.8,
            "entropy" : 3.94617750050791
        }
    }
}</pre>
</div>
<p>The name of the aggregation (<code class="literal">message_stats</code> above) also serves as the key by which the aggregation result can be retrieved from
the returned response.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_character_distribution"></a>Character distribution<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/metrics/string-stats-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>The computation of the Shannon Entropy value is based on the probability of each character appearing in all terms collected
by the aggregation. To view the probability distribution for all characters, we can add the <code class="literal">show_distribution</code> (default: <code class="literal">false</code>) parameter.</p>
<a id="a1d02ab1549dbd3f1874f6a2fd48ec48"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /twitter/_search?size=0
{
    "aggs" : {
        "message_stats" : {
            "string_stats" : {
                "field" : "message.keyword",
                "show_distribution": true  <a id="CO206-1"></a><i class="conum" data-value="1"></i>
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/387.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO206-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set the <code class="literal">show_distribution</code> parameter to <code class="literal">true</code>, so that probability distribution for all characters is returned in the results.</p>
</td>
</tr>
</table>
</div>
<a id="947b84333fcecc39a23f10a8d6b16751"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
    ...

    "aggregations": {
        "message_stats" : {
            "count" : 5,
            "min_length" : 24,
            "max_length" : 30,
            "avg_length" : 28.8,
            "entropy" : 3.94617750050791,
            "distribution" : {
                " " : 0.1527777777777778,
                "e" : 0.14583333333333334,
                "s" : 0.09722222222222222,
                "m" : 0.08333333333333333,
                "t" : 0.0763888888888889,
                "h" : 0.0625,
                "a" : 0.041666666666666664,
                "i" : 0.041666666666666664,
                "r" : 0.041666666666666664,
                "g" : 0.034722222222222224,
                "n" : 0.034722222222222224,
                "o" : 0.034722222222222224,
                "u" : 0.034722222222222224,
                "b" : 0.027777777777777776,
                "w" : 0.027777777777777776,
                "c" : 0.013888888888888888,
                "E" : 0.006944444444444444,
                "l" : 0.006944444444444444,
                "1" : 0.006944444444444444,
                "2" : 0.006944444444444444,
                "3" : 0.006944444444444444,
                "4" : 0.006944444444444444,
                "y" : 0.006944444444444444
            }
        }
    }
}</pre>
</div>
<p>The <code class="literal">distribution</code> object shows the probability of each character appearing in all terms. The characters are sorted by descending probability.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_script_12"></a>Script<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/metrics/string-stats-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Computing the message string stats based on a script:</p>
<a id="24b22f8b83e9b199964036a170e4299e"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /twitter/_search?size=0
{
    "aggs" : {
        "message_stats" : {
             "string_stats" : {
                 "script" : {
                     "lang": "painless",
                     "source": "doc['message.keyword'].value"
                 }
             }
         }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/388.console"></div>
<p>This will interpret the <code class="literal">script</code> parameter as an <code class="literal">inline</code> script with the <code class="literal">painless</code> script language and no script parameters.
To use a stored script use the following syntax:</p>
<a id="a89a22d4f41ee3538bbfec8ac9e7ac74"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /twitter/_search?size=0
{
    "aggs" : {
        "message_stats" : {
            "string_stats" : {
                "script" : {
                    "id": "my_script",
                    "params" : {
                        "field" : "message.keyword"
                    }
                }
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/389.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_value_script_6"></a>Value Script<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/metrics/string-stats-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>We can use a value script to modify the message (eg we can add a prefix) and compute the new stats:</p>
<a id="46078bde3789b5e7e83ab458857bc9c9"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /twitter/_search?size=0
{
    "aggs" : {
        "message_stats" : {
            "string_stats" : {
                "field" : "message.keyword",
                "script" : {
                    "lang": "painless",
                    "source": "params.prefix + _value",
                    "params" : {
                        "prefix" : "Message: "
                    }
                }
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/390.console"></div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_missing_value_11"></a>Missing value<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/metrics/string-stats-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">missing</code> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they had a value.</p>
<a id="437f4009a93d46b6b76e7db366b34ce6"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /twitter/_search?size=0
{
    "aggs" : {
        "message_stats" : {
            "string_stats" : {
                "field" : "message.keyword",
                "missing": "[empty message]" <a id="CO207-1"></a><i class="conum" data-value="1"></i>
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/391.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO207-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Documents without a value in the <code class="literal">message</code> field will be treated as documents that have the value <code class="literal">[empty message]</code>.</p>
</td>
</tr>
</table>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="search-aggregations-metrics-scripted-metric-aggregation.html">« Scripted Metric Aggregation</a>
</span>
<span class="next">
<a href="search-aggregations-metrics-sum-aggregation.html">Sum Aggregation »</a>
</span>
</div>
</div>
</body>
</html>
