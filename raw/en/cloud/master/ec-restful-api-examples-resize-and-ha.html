<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Applying a new plan: Resize and add high availability
        | Elasticsearch Service Documentation [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Service Documentation [master]" /><link rel="up" href="ec-restful-api-examples.html" title="API examples" /><link rel="prev" href="ec-restful-api-examples-create-deployment.html" title="Create a first deployment: Just an Elasticsearch cluster" /><link rel="next" href="ec-restful-api-examples-progress-checking.html" title="Applying a new plan: Checking on progress" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Cloud/Reference/master" /><meta name="DC.subject" content="Elastic Cloud" /><meta name="DC.identifier" content="master" /></head><body><div class="page_header">You are looking at the future. Not what you want? See the <a href="https://www.elastic.co/guide/en/cloud/current/index.html">current release documentation</a>.</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="ec-restful-api.html">RESTful API</a></span> » <span class="breadcrumb-link"><a href="ec-restful-api-examples.html">API examples</a></span> » <span class="breadcrumb-node">Applying a new plan: Resize and add high availability</span></div><div class="navheader"><span class="prev"><a href="ec-restful-api-examples-create-deployment.html">
              « 
              Create a first deployment: Just an Elasticsearch cluster</a>
           
        </span><span class="next">
           
          <a href="ec-restful-api-examples-progress-checking.html">Applying a new plan: Checking on progress
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ec-restful-api-examples-resize-and-ha"></a>Applying a new plan: Resize and add high availability</h2></div></div></div><p>In an earlier example, we created a simple deployment called <code class="literal">My First Deployment</code> that included only a small Elasticsearch cluster with a single node in a single availability zone. This Elasticsearch cluster in our deployment is very small with only 1024 MB of RAM. Any serious indexing activity will likely require more capacity, so let’s change <code class="literal">memory_per_node</code> to <code class="literal">4096</code>. To make the cluster in our deployment highly available, let’s also change the value of <code class="literal">zone_count</code> to <code class="literal">3</code>, which will create Elasticsearch nodes across three availability zones.</p><h4><a id="ec-before_you_begin_18"></a>Before you begin</h4><p>This example requires a deployment with an Elasticsearch cluster to work with that is not being used for anything important. If you don’t already have one, you can follow <a class="link" href="ec-restful-api-examples-create-deployment.html" title="Create a first deployment: Just an Elasticsearch cluster">our <code class="literal">My First Deployment</code> example</a> to create one.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>To make the cluster highly available, your Elasticsearch Service installation must include more than one availability zone, which is something you control with the <code class="literal">--availability-zone</code> parameter when you install Elasticsearch Service on additional hosts. If you don’t have additional availability zones to work with, you can perform just a resize operation.</p></div></div><h4><a id="ec-steps_3"></a>Steps</h4><p>To resize a deployment and add high availability:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Obtain the existing configuration plan for <code class="literal">My First Deployment</code> and save the output to a file, here <code class="literal">my-first-deployment.json</code>:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X POST -u $USER<a id="CO19-1"></a><i class="conum" data-value="1"></i>:$PASSWORD<a id="CO19-2"></a><i class="conum" data-value="2"></i> https://$CLUSTER_ID<a id="CO19-3"></a><i class="conum" data-value="3"></i>.REGION<a id="CO19-4"></a><i class="conum" data-value="4"></i>.PLATFORM<a id="CO19-5"></a><i class="conum" data-value="5"></i>.DOMAIN<a id="CO19-6"></a><i class="conum" data-value="6"></i>:9243/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID<a id="CO19-7"></a><i class="conum" data-value="7"></i>/plan &gt;my-first-deployment.json</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
A user with sufficient privileges
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>
The password for the user
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>
The cluster ID that is unique to your cluster
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>
The geographic region within your cloud platform. For example, <code class="literal">us-east-1</code> or <code class="literal">us-central1</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-5"><i class="conum" data-value="5"></i></a> </p></td><td valign="top" align="left"><p>
The cloud platform, either <code class="literal">aws</code> for Amazon Web Services or <code class="literal">gcp</code> for Google Cloud Platform
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-6"><i class="conum" data-value="6"></i></a> </p></td><td valign="top" align="left"><p>
The domain name. For example, <code class="literal">cloud.es.io</code> or <code class="literal">found.io</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-7"><i class="conum" data-value="7"></i></a> </p></td><td valign="top" align="left"><p>
The Elasticsearch cluster ID as shown in the Cloud UI or obtained via the API
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
Edit the <code class="literal">my-first-deployment.json</code> file in your favorite editor and change the value of <code class="literal">memory_per_node</code> to <code class="literal">4096</code> and the value of <code class="literal">zone_count</code> to <code class="literal">3</code>:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">{
  "cluster_topology": [
      {
          "node_type": {
              "data": true,
              "master": true,
              "ingest": true
          },
          "instance_configuration_id": "data.default",
          "zone_count": 3,
          "size": {
              "resource": "memory",
              "value": 4096
          }
      }
  ],
  "elasticsearch": {
      "version": "6.5.4"
  }
}</pre></div></li><li class="listitem"><p class="simpara">
Apply the updated cluster configuration to the deployment with a POST request:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X POST -u $USER<a id="CO20-1"></a><i class="conum" data-value="1"></i>:$PASSWORD<a id="CO20-2"></a><i class="conum" data-value="2"></i> https://$CLUSTER_ID<a id="CO20-3"></a><i class="conum" data-value="3"></i>.REGION<a id="CO20-4"></a><i class="conum" data-value="4"></i>.PLATFORM<a id="CO20-5"></a><i class="conum" data-value="5"></i>.DOMAIN<a id="CO20-6"></a><i class="conum" data-value="6"></i>:9243
/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID/plan -H 'content-type: application/json' -d @my-first-deployment.json</pre></div></li></ol></div><p>After the plan gets applied successfully, the Elasticsearch cluster in your deployment provides 4096 MB of memory and is highly available, which you can verify by checking in the Cloud UI or performing another GET request on the <code class="literal">/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID/plan</code> endpoint.</p></div><div class="navfooter"><span class="prev"><a href="ec-restful-api-examples-create-deployment.html">
              « 
              Create a first deployment: Just an Elasticsearch cluster</a>
           
        </span><span class="next">
           
          <a href="ec-restful-api-examples-progress-checking.html">Applying a new plan: Checking on progress
               »
            </a></span></div></body></html>
