<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Capture Thrift traffic
        | Packetbeat Reference [7.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Packetbeat Reference [7.4]" /><link rel="up" href="configuration-protocols.html" title="Specify which transaction protocols to monitor" /><link rel="prev" href="packetbeat-pgsql-options.html" title="Capture PgSQL traffic" /><link rel="next" href="configuration-mongodb.html" title="Capture MongoDB traffic" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Packetbeat/Reference/7.4" /><meta name="DC.subject" content="Packetbeat" /><meta name="DC.identifier" content="7.4" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Packetbeat Reference
      [7.4]
    </a></span> » <span class="breadcrumb-link"><a href="configuring-howto-packetbeat.html">Configuring Packetbeat</a></span> » <span class="breadcrumb-link"><a href="configuration-protocols.html">Specify which transaction protocols to monitor</a></span> » <span class="breadcrumb-node">Capture Thrift traffic</span></div><div class="navheader"><span class="prev"><a href="packetbeat-pgsql-options.html">
              « 
              Capture PgSQL traffic</a>
           
        </span><span class="next">
           
          <a href="configuration-mongodb.html">Capture MongoDB traffic
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-thrift"></a>Capture Thrift traffic<a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><a class="ulink" href="https://thrift.apache.org/" target="_top">Apache Thrift</a> is a communication protocol and RPC
framework initially created at Facebook. It is sometimes used in
<a class="ulink" href="http://martinfowler.com/articles/microservices.html" target="_top">microservices</a>
architectures because it provides better performance when compared to the more
obvious HTTP/RESTful API choice, while still supporting a wide range of
programming languages and frameworks.</p><p>Packetbeat works based on a copy of the traffic, which means that you get
performance management features without having to modify your services in
any way and without any latency overhead. Packetbeat captures the transactions from the
network and indexes them in Elasticsearch so that they can be analyzed and
searched.</p><p>Packetbeat indexes the method, parameters, return value, and
exceptions of each Thrift-RPC call. You can search by and create statistics
based on any of these fields. Packetbeat automatically fills in the <code class="literal">status</code>
column with either <code class="literal">OK</code> or <code class="literal">Error</code>, so it’s easy to find the problematic RPC calls.
A transaction is put into the <code class="literal">Error</code> state if it returned an exception.</p><p>Packetbeat also indexes the <code class="literal">event.duration</code> field so you can get performance
analytics and find the slow RPC calls.</p><p>Here is an example performance dashboard:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/thrift-dashboard.png" alt="Thrift-RPC dashboard" /></div></div><p>Thrift supports multiple <a class="ulink" href="http://en.wikipedia.org/wiki/Apache_Thrift" target="_top">transport
and protocol types</a>. Currently Packetbeat supports the default <code class="literal">TSocket</code>
transport as well as the <code class="literal">TFramed</code> transport. From the protocol point of view,
Packetbeat currently supports only the default <code class="literal">TBinary</code> protocol.</p><p>Packetbeat also has several configuration options that allow you to get
the right balance between visibility, disk usage, and data protection. You can,
for example, choose to obfuscate all strings or to store the requests but not
the responses, while still capturing the response time for each of the RPC
calls. You can also choose to limit the size of strings and lists to a given
number of elements, so you can fine tune how much data you want to have stored in
Elasticsearch.</p><p>The Thrift protocol has several specific configuration options. Here is an
example configuration section for the Thrift protocol in the
<code class="literal">packetbeat.yml</code> config file:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">packetbeat.protocols:
- type: thrift
  transport_type: socket
  protocol_type: binary
  idl_files: ["tutorial.thrift", "shared.thrift"]
  string_max_size: 200
  collection_max_size: 20
  capture_reply: true
  obfuscate_strings: true
  drop_after_n_struct_fields: 100</pre></div><p>Providing the Thrift IDL files to Packetbeat is optional. The binary
Thrift messages include the called method name and enough structural information
to decode the messages without needing the IDL files. However, if you
provide the IDL files, Packetbeat can also resolve the service name,
arguments, and exception names.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_configuration_options_10"></a>Configuration options<a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Also see <a class="xref" href="common-protocol-options.html" title="Common protocol options">Common protocol options</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_transport_type_literal"></a><code class="literal">transport_type</code><a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The Thrift transport type. Currently this option accepts the values <code class="literal">socket</code>
for TSocket, which is the default Thrift transport, and <code class="literal">framed</code> for the TFramed Thrift
transport. The default is <code class="literal">socket</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_protocol_type_literal"></a><code class="literal">protocol_type</code><a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The Thrift protocol type. Currently the only accepted value is <code class="literal">binary</code> for
the TBinary protocol, which is the default Thrift protocol.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_idl_files_literal"></a><code class="literal">idl_files</code><a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The Thrift interface description language (IDL) files for the service that
Packetbeat is monitoring. Providing the IDL files is optional, because the Thrift
messages contain enough information to decode them without having the IDL
files. However, providing the IDL enables Packetbeat to include parameter and
exception names.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_string_max_size_literal"></a><code class="literal">string_max_size</code><a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The maximum length for strings in parameters or return values. If a string is longer than
this value, the string is automatically truncated to this length. Packetbeat adds dots
at the end of the string to mark that it was truncated. The default is 200.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_collection_max_size_literal"></a><code class="literal">collection_max_size</code><a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The maximum number of elements in a Thrift list, set, map, or structure. If a collection
has more elements than this value, Packetbeat captures only the
specified number of elements. Packetbeat adds a fictive last element <code class="literal">...</code> to the end
of the collection to mark that it was truncated. The default is 15.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_capture_reply_literal"></a><code class="literal">capture_reply</code><a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If this option is set to false, Packetbeat decodes the method name from
the reply and simply skips the rest of the response message. This setting can be useful
for performance, disk usage, or data retention reasons. The default is true.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_obfuscate_strings_literal"></a><code class="literal">obfuscate_strings</code><a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If this option is set to true, Packetbeat replaces all strings found in method parameters,
return codes, or exception structures with the <code class="literal">"*"</code> string.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_drop_after_n_struct_fields_literal"></a><code class="literal">drop_after_n_struct_fields</code><a href="https://github.com/elastic/beats/edit/7.4/packetbeat/docs/packetbeat-options.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The maximum number of fields that a structure can have before Packetbeat
ignores the whole transaction. This is a memory protection mechanism (so that
Packetbeat’s memory doesn’t grow indefinitely), so you would typically set this
to a relatively high value. The default is 500.</p></div></div></div><div class="navfooter"><span class="prev"><a href="packetbeat-pgsql-options.html">
              « 
              Capture PgSQL traffic</a>
           
        </span><span class="next">
           
          <a href="configuration-mongodb.html">Capture MongoDB traffic
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
