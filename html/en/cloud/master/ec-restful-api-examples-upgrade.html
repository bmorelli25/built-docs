<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Applying a new deployment configuration: Upgrade
        | Elasticsearch Service Documentation [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Service Documentation [master]" /><link rel="up" href="ec-restful-api-examples.html" title="API examples" /><link rel="prev" href="ec-restful-api-examples-progress-checking.html" title="Applying a new plan: Checking on progress" /><link rel="next" href="ec-restful-api-examples-add-kibana.html" title="Enable more stack features: Add Kibana to a deployment" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Cloud/Reference/master" /><meta name="DC.subject" content="Elastic Cloud" /><meta name="DC.identifier" content="master" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at the future. Not what you want? See the <a href="https://www.elastic.co/guide/en/cloud/current/index.html">current release documentation</a>.</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="ec-restful-api.html">RESTful API</a></span> » <span class="breadcrumb-link"><a href="ec-restful-api-examples.html">API examples</a></span> » <span class="breadcrumb-node">Applying a new deployment configuration: Upgrade</span></div><div class="navheader"><span class="prev"><a href="ec-restful-api-examples-progress-checking.html">
              « 
              Applying a new plan: Checking on progress</a>
           
        </span><span class="next">
           
          <a href="ec-restful-api-examples-add-kibana.html">Enable more stack features: Add Kibana to a deployment
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ec-restful-api-examples-upgrade"></a>Applying a new deployment configuration: Upgrade</h2></div></div></div><p>One of the many useful aspects of an API is that you can automate changes across a large number of deployments. Let’s say you have many deployments that are at a specific version of the Elastic Stack that need to get upgraded to the next minor release, here from version 6.5.4 to 6.6.0. You can either surreptitiously change the version of each deployments in the Cloud UI or you can automate finding all the deployments at the specific version level and upgrading them through a script.</p><h4><a id="ec-before_you_begin_19"></a>Before you begin</h4><p>This example requires a deployment with an Elasticsearch cluster to work with that is not being used for anything important. If you don’t already have one, you can follow <a class="link" href="ec-restful-api-examples-create-deployment.html" title="Create a first deployment: Just an Elasticsearch cluster">our <code class="literal">My First Deployment</code> example</a> to create one.</p><p>Each version of Elasticsearch Service ships with some versions of the Elastic Stack, but you can add new versions as they become available.</p><p>You can search for clusters that are at a specific version through the RESTful API or you can iterate over the JSON output from the API to get the list you need, similar to what Step 1 shows.</p><h4><a id="ec-steps_4"></a>Steps</h4><p>To upgrade a cluster:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Get a list of the deployments and find the Elasticsearch clusters that need upgrading, here <code class="literal">My First Deployment</code>:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X GET -u $USER<a id="CO21-7"></a><i class="conum" data-value="1"></i>:$PASSWORD<a id="CO21-8"></a><i class="conum" data-value="2"></i> https://$CLUSTER_ID<a id="CO21-9"></a><i class="conum" data-value="3"></i>.REGION<a id="CO21-10"></a><i class="conum" data-value="4"></i>.PLATFORM<a id="CO21-11"></a><i class="conum" data-value="5"></i>.DOMAIN<a id="CO21-12"></a><i class="conum" data-value="6"></i>:9243
/api/v1/clusters/elasticsearch?q=plan_info.current.plan.elasticsearch.version:6.5.4
{
  "return_count": 1,
  "match_count": 1,
  "elasticsearch_clusters": [{
    "cluster_name": "My First Deployment",

    ...

            "elasticsearch": {
            "version": "6.5.4"
          },

            ...

      "cluster_id": "19a4462c52694cc7ae94a50cfacd6631",

      ...

  }</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-1"><i class="conum" data-value="1"></i></a> <a href="#CO21-7"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
A user with sufficient privileges
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-2"><i class="conum" data-value="2"></i></a> <a href="#CO21-8"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>
The password for the user
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-3"><i class="conum" data-value="3"></i></a> <a href="#CO21-9"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>
The cluster ID that is unique to your cluster
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-4"><i class="conum" data-value="4"></i></a> <a href="#CO21-10"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>
The geographic region within your cloud platform. For example, <code class="literal">us-east-1</code> or <code class="literal">us-central1</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-5"><i class="conum" data-value="5"></i></a> <a href="#CO21-11"><i class="conum" data-value="5"></i></a> </p></td><td valign="top" align="left"><p>
The cloud platform, either <code class="literal">aws</code> for Amazon Web Services or <code class="literal">gcp</code> for Google Cloud Platform
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-6"><i class="conum" data-value="6"></i></a> <a href="#CO21-12"><i class="conum" data-value="6"></i></a> </p></td><td valign="top" align="left"><p>
The domain name. For example, <code class="literal">cloud.es.io</code> or <code class="literal">found.io</code>
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
For each of the clusters that you want to upgrade, obtain the JSON for the existing plan and save it to a file:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X GET -u $USER:$PASSWORD https://$CLUSTER_ID.$REGION.$PLATFORM.$DOMAIN:9243
/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID<a id="CO22-1"></a><i class="conum" data-value="1"></i>/plan &gt;upgrade_me.json</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
The Elasticsearch cluster ID, here <code class="literal">19a4462c52694cc7ae94a50cfacd6631</code> for <code class="literal">My First Deployment</code>
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
Modify the plan stored in <code class="literal">upgrade_me.json</code>. In this case, the line that specifies the version needs to be changed to read <code class="literal">"version": "6.6.0"</code>:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">{
  "cluster_topology": [{
    "node_type": {
      "master": true,
      "data": true,
      "ingest": true
    },
    "zone_count": 3,
    "instance_configuration_id": "data.default",
    "size": {
      "value": 4096,
      "resource": "memory"
    }
  }, {
    "node_type": {
      "master": true,
      "data": false,
      "ingest": false
    },
    "zone_count": 1,
    "instance_configuration_id": "master",
    "size": {
      "value": 0,
      "resource": "memory"
    }
  }, {
    "node_type": {
      "master": false,
      "data": false,
      "ingest": false,
      "ml": true
    },
    "zone_count": 1,
    "instance_configuration_id": "ml",
    "size": {
      "value": 0,
      "resource": "memory"
    }
  }],
  "elasticsearch": {
    "version": "6.6.0"
  },
  "deployment_template": {
    "id": "default"
  }
}</pre></div></li><li class="listitem"><p class="simpara">
Apply the new plan to effect a version upgrade:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X POST -u $USER:$PASSWORD https://$CLUSTER_ID.$REGION.$PLATFORM.$DOMAIN:9243/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID/plan -H 'content-type: application/json' -d @upgrade_me.json</pre></div><p class="simpara">After the upgrade operation completes, the cluster will be at version 6.6.0.</p></li><li class="listitem"><p class="simpara">
Optional: Repeat step 1 to verify that there are no more clusters at the old version that need to be upgraded:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">{
  "return_count": 0,
  "match_count": 0,
  "elasticsearch_clusters": []
}</pre></div></li></ol></div></div><div class="navfooter"><span class="prev"><a href="ec-restful-api-examples-progress-checking.html">
              « 
              Applying a new plan: Checking on progress</a>
           
        </span><span class="next">
           
          <a href="ec-restful-api-examples-add-kibana.html">Enable more stack features: Add Kibana to a deployment
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
