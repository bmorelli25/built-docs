<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="Playing with Asciidoctor to create Elastic Stack docs">
<meta name="keywords" content="Elasticsearch, Kibana, Logstash">
<title>Machine learning functions | Elastic Stack docs | Elastic</title>
<link rel="home" href="index.html" title="Elastic Stack docs"/>
<link rel="up" href="_reference.html" title="Reference"/>
<link rel="prev" href="kibana-apis.html" title="Kibana APIs"/>
<link rel="next" href="ml-modules.html" title="Machine learning modules"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack"/>
<meta name="DC.subject" content="Elastic Stack"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elastic Stack docs</a></span>
»
<span class="breadcrumb-link"><a href="_reference.html">Reference</a></span>
»
<span class="breadcrumb-node">Machine learning functions</span>
</div>
<div class="navheader">
<span class="prev">
<a href="kibana-apis.html">« Kibana APIs</a>
</span>
<span class="next">
<a href="ml-modules.html">Machine learning modules »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-functions"></a>Machine learning functions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/landing.asciidoc">edit</a></h2>
</div></div></div>
<p>The machine learning features include analysis functions that provide a wide variety of
flexible ways to analyze data for anomalies.</p>
<p>When you create anomaly detection jobs, you specify one or more detectors, which define
the type of analysis that needs to be done. If you are creating your job by
using machine learning APIs, you specify the functions in detector configuration objects.
If you are creating your job in Kibana, you specify the functions differently
depending on whether you are creating single metric, multi-metric, or advanced
jobs.</p>
<p>Most functions detect anomalies in both low and high values. In statistical
terminology, they apply a two-sided test. Some functions offer low and high
variations (for example, <code class="literal">count</code>, <code class="literal">low_count</code>, and <code class="literal">high_count</code>). These variations
apply one-sided tests, detecting anomalies only when the values are low or
high, depending one which alternative is used.</p>
<p>You can specify a <code class="literal">summary_count_field_name</code> with any function except <code class="literal">metric</code>.
When you use <code class="literal">summary_count_field_name</code>, the machine learning features expect the input
data to be pre-aggregated. The value of the <code class="literal">summary_count_field_name</code> field
must contain the count of raw events that were summarized. In Kibana, use the
<span class="strong strong"><strong>summary_count_field_name</strong></span> in advanced anomaly detection jobs. Analyzing aggregated
input data provides a significant boost in performance. For more information, see
<a class="xref" href="ml-configuring-aggregation.html" title="Aggregating data for faster performance">Aggregating data for faster performance</a>.</p>
<p>If your data is sparse, there may be gaps in the data which means you might have
empty buckets. You might want to treat these as anomalies or you might want these
gaps to be ignored. Your decision depends on your use case and what is important
to you. It also depends on which functions you use. The <code class="literal">sum</code> and <code class="literal">count</code>
functions are strongly affected by empty buckets. For this reason, there are
<code class="literal">non_null_sum</code> and <code class="literal">non_zero_count</code> functions, which are tolerant to sparse data.
These functions effectively ignore empty buckets.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-count-functions" title="Count functions">Count functions</a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-geo-functions" title="Geographic functions">Geographic functions</a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-info-functions" title="Information Content Functions">Information Content Functions</a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-metric-functions" title="Metric functions">Metric functions</a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-rare-functions" title="Rare functions">Rare functions</a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-sum-functions" title="Sum functions">Sum functions</a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-time-functions" title="Time functions">Time functions</a>
</li>
</ul>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-count-functions"></a>Count functions<a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>Count functions detect anomalies when the number of events in a bucket is
anomalous.</p>
<p>Use <code class="literal">non_zero_count</code> functions if your data is sparse and you want to ignore
cases where the bucket count is zero.</p>
<p>Use <code class="literal">distinct_count</code> functions to determine when the number of distinct values
in one field is unusual, as opposed to the total count.</p>
<p>Use high-sided functions if you want to monitor unusually high event rates.
Use low-sided functions if you want to look at drops in event rate.</p>
<p>The machine learning features include the following count functions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-count" title="Count, high_count, low_count"><code class="literal">count</code>, <code class="literal">high_count</code>, <code class="literal">low_count</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-nonzero-count" title="Non_zero_count, high_non_zero_count, low_non_zero_count"><code class="literal">non_zero_count</code>, <code class="literal">high_non_zero_count</code>, <code class="literal">low_non_zero_count</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-distinct-count" title="Distinct_count, high_distinct_count, low_distinct_count"><code class="literal">distinct_count</code>, <code class="literal">high_distinct_count</code>, <code class="literal">low_distinct_count</code></a>
</li>
</ul>
</div>
<h6><a id="ml-count"></a>Count, high_count, low_count</h6>
<p>The <code class="literal">count</code> function detects anomalies when the number of events in a bucket is
anomalous.</p>
<p>The <code class="literal">high_count</code> function detects anomalies when the count of events in a
bucket are unusually high.</p>
<p>The <code class="literal">low_count</code> function detects anomalies when the count of events in a
bucket are unusually low.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 1: Analyzing events with the count function.</strong></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/example1
{
  "analysis_config": {
    "detectors": [{
      "function" : "count"
    }]
  },
  "data_description": {
    "time_field":"timestamp",
    "time_format": "epoch_ms"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/36.console"></div>
<p>This example is probably the simplest possible analysis. It identifies
time buckets during which the overall count of events is higher or lower than
usual.</p>
<p>When you use this function in a detector in your anomaly detection job, it models the
event rate and detects when the event rate is unusual compared to its past
behavior.</p>
<p><strong>Example 2: Analyzing errors with the high_count function.</strong></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/example2
{
  "analysis_config": {
    "detectors": [{
      "function" : "high_count",
      "by_field_name" : "error_code",
      "over_field_name": "user"
    }]
  },
  "data_description": {
    "time_field":"timestamp",
    "time_format": "epoch_ms"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/37.console"></div>
<p>If you use this <code class="literal">high_count</code> function in a detector in your anomaly detection job, it
models the event rate for each error code. It detects users that generate an
unusually high count of error codes compared to other users.</p>
<p><strong>Example 3: Analyzing status codes with the low_count function.</strong></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/example3
{
  "analysis_config": {
    "detectors": [{
      "function" : "low_count",
      "by_field_name" : "status_code"
    }]
  },
  "data_description": {
    "time_field":"timestamp",
    "time_format": "epoch_ms"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/38.console"></div>
<p>In this example, the function detects when the count of events for a
status code is lower than usual.</p>
<p>When you use this function in a detector in your anomaly detection job, it models the
event rate for each status code and detects when a status code has an unusually
low count compared to its past behavior.</p>
<p><strong>Example 4: Analyzing aggregated data with the count function.</strong></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/example4
{
  "analysis_config": {
    "summary_count_field_name" : "events_per_min",
    "detectors": [{
      "function" : "count"
    }]
  },
  "data_description": {
    "time_field":"timestamp",
    "time_format": "epoch_ms"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/39.console"></div>
<p>If you are analyzing an aggregated <code class="literal">events_per_min</code> field, do not use a sum
function (for example, <code class="literal">sum(events_per_min)</code>). Instead, use the count function
and the <code class="literal">summary_count_field_name</code> property. For more information, see
<a class="xref" href="ml-configuring-aggregation.html" title="Aggregating data for faster performance">Aggregating data for faster performance</a>.</p>
<h6><a id="ml-nonzero-count"></a>Non_zero_count, high_non_zero_count, low_non_zero_count</h6>
<p>The <code class="literal">non_zero_count</code> function detects anomalies when the number of events in a
bucket is anomalous, but it ignores cases where the bucket count is zero. Use
this function if you know your data is sparse or has gaps and the gaps are not
important.</p>
<p>The <code class="literal">high_non_zero_count</code> function detects anomalies when the number of events
in a bucket is unusually high and it ignores cases where the bucket count is
zero.</p>
<p>The <code class="literal">low_non_zero_count</code> function detects anomalies when the number of events in
a bucket is unusually low and it ignores cases where the bucket count is zero.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p>For example, if you have the following number of events per bucket:</p>
<div class="exampleblock">
<div class="content">
<p>1,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,43,31,0,0,0,0,0,0,0,0,0,0,0,0,2,1</p>
</div>
</div>
<p>The <code class="literal">non_zero_count</code> function models only the following data:</p>
<div class="exampleblock">
<div class="content">
<p>1,22,2,43,31,2,1</p>
</div>
</div>
<p><strong>Example 5: Analyzing signatures with the high_non_zero_count function.</strong></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/example5
{
  "analysis_config": {
    "detectors": [{
      "function" : "high_non_zero_count",
      "by_field_name" : "signaturename"
    }]
  },
  "data_description": {
    "time_field":"timestamp",
    "time_format": "epoch_ms"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/40.console"></div>
<p>If you use this <code class="literal">high_non_zero_count</code> function in a detector in your
anomaly detection job, it models the count of events for the <code class="literal">signaturename</code> field. It
ignores any buckets where the count is zero and detects when a <code class="literal">signaturename</code>
value has an unusually high count of events compared to its past behavior.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Population analysis (using an <code class="literal">over_field_name</code> property value) is not
supported for the <code class="literal">non_zero_count</code>, <code class="literal">high_non_zero_count</code>, and
<code class="literal">low_non_zero_count</code> functions. If you want to do population analysis and your
data is sparse, use the <code class="literal">count</code> functions, which are optimized for that scenario.</p>
</div>
</div>
<h6><a id="ml-distinct-count"></a>Distinct_count, high_distinct_count, low_distinct_count</h6>
<p>The <code class="literal">distinct_count</code> function detects anomalies where the number of distinct
values in one field is unusual.</p>
<p>The <code class="literal">high_distinct_count</code> function detects unusually high numbers of distinct
values in one field.</p>
<p>The <code class="literal">low_distinct_count</code> function detects unusually low numbers of distinct
values in one field.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 6: Analyzing users with the distinct_count function.</strong></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/example6
{
  "analysis_config": {
    "detectors": [{
      "function" : "distinct_count",
      "field_name" : "user"
    }]
  },
  "data_description": {
    "time_field":"timestamp",
    "time_format": "epoch_ms"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/41.console"></div>
<p>This <code class="literal">distinct_count</code> function detects when a system has an unusual number
of logged in users. When you use this function in a detector in your
anomaly detection job, it models the distinct count of users. It also detects when the
distinct number of users is unusual compared to the past.</p>
<p><strong>Example 7: Analyzing ports with the high_distinct_count function.</strong></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/example7
{
  "analysis_config": {
    "detectors": [{
      "function" : "high_distinct_count",
      "field_name" : "dst_port",
      "over_field_name": "src_ip"
    }]
  },
  "data_description": {
    "time_field":"timestamp",
    "time_format": "epoch_ms"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/42.console"></div>
<p>This example detects instances of port scanning. When you use this function in a
detector in your anomaly detection job, it models the distinct count of ports. It also
detects the <code class="literal">src_ip</code> values that connect to an unusually high number of different
<code class="literal">dst_ports</code> values compared to other <code class="literal">src_ip</code> values.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-geo-functions"></a>Geographic functions<a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>The geographic functions detect anomalies in the geographic location of the
input data.</p>
<p>The machine learning features include the following geographic function: <code class="literal">lat_long</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot create forecasts for anomaly detection jobs that contain geographic
functions. You also cannot add rules with conditions to detectors that use
geographic functions.</p>
</div>
</div>
<h5><a id="ml-lat-long"></a>Lat_long</h5>
<p>The <code class="literal">lat_long</code> function detects anomalies in the geographic location of the
input data.</p>
<p>This function supports the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 1: Analyzing transactions with the lat_long function.</strong></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/example1
{
  "analysis_config": {
    "detectors": [{
      "function" : "lat_long",
      "field_name" : "transactionCoordinates",
      "by_field_name" : "creditCardNumber"
    }]
  },
  "data_description": {
    "time_field":"timestamp",
    "time_format": "epoch_ms"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/43.console"></div>
<p>If you use this <code class="literal">lat_long</code> function in a detector in your anomaly detection job, it
detects anomalies where the geographic location of a credit card transaction is
unusual for a particular customer’s credit card. An anomaly might indicate fraud.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">field_name</code> that you supply must be a single string that contains
two comma-separated numbers of the form <code class="literal">latitude,longitude</code>, a <code class="literal">geo_point</code> field,
a <code class="literal">geo_shape</code> field that contains point values, or a <code class="literal">geo_centroid</code> aggregation.
The <code class="literal">latitude</code> and <code class="literal">longitude</code> must be in the range -180 to 180 and represent a
point on the surface of the Earth.</p>
</div>
</div>
<p>For example, JSON data might contain the following transaction coordinates:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "time": 1460464275,
  "transactionCoordinates": "40.7,-74.0",
  "creditCardNumber": "1234123412341234"
}</pre>
</div>
<p>In Elasticsearch, location data is likely to be stored in <code class="literal">geo_point</code> fields. For more
information, see <a href="/guide/en/elasticsearch/reference/master/geo-point.html" class="ulink" target="_top">Geo-point datatype</a>. This data type is
supported natively in machine learning features. Specifically, datafeed when pulling data from
a <code class="literal">geo_point</code> field, will transform the data into the appropriate <code class="literal">lat,lon</code> string
format before sending to the anomaly detection job.</p>
<p>For more information, see <a class="xref" href="ml-configuring-transform.html" title="Transforming data with script fields">Transforming data with script fields</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-info-functions"></a>Information Content Functions</h3>
</div></div></div>
<p>The information content functions detect anomalies in the amount of information
that is contained in strings within a bucket. These functions can be used as
a more sophisticated method to identify incidences of data exfiltration or
C2C activity, when analyzing the size in bytes of the data might not be sufficient.</p>
<p>The machine learning features include the following information content functions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">info_content</code>, <code class="literal">high_info_content</code>, <code class="literal">low_info_content</code>
</li>
</ul>
</div>
<h5><a id="ml-info-content"></a>Info_content, High_info_content, Low_info_content</h5>
<p>The <code class="literal">info_content</code> function detects anomalies in the amount of information that
is contained in strings in a bucket.</p>
<p>If you want to monitor for unusually high amounts of information,
use <code class="literal">high_info_content</code>.
If want to look at drops in information content, use <code class="literal">low_info_content</code>.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 1: Analyzing subdomain strings with the info_content function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "info_content",
  "field_name" : "subdomain",
  "over_field_name" : "highest_registered_domain"
}</pre>
</div>
<p>If you use this <code class="literal">info_content</code> function in a detector in your anomaly detection job, it
models information that is present in the <code class="literal">subdomain</code> string. It detects
anomalies where the information content is unusual compared to the other
<code class="literal">highest_registered_domain</code> values. An anomaly could indicate an abuse of the
DNS protocol, such as malicious command and control activity.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In this example, both high and low values are considered anomalous.
In many use cases, the <code class="literal">high_info_content</code> function is often a more appropriate
choice.</p>
</div>
</div>
<p><strong>Example 2: Analyzing query strings with the high_info_content function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "high_info_content",
  "field_name" : "query",
  "over_field_name" : "src_ip"
}</pre>
</div>
<p>If you use this <code class="literal">high_info_content</code> function in a detector in your anomaly detection job,
it models information content that is held in the DNS query string. It detects
<code class="literal">src_ip</code> values where the information content is unusually high compared to
other <code class="literal">src_ip</code> values. This example is similar to the example for the
<code class="literal">info_content</code> function, but it reports anomalies only where the amount of
information content is higher than expected.</p>
<p><strong>Example 3: Analyzing message strings with the low_info_content function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "low_info_content",
  "field_name" : "message",
  "by_field_name" : "logfilename"
}</pre>
</div>
<p>If you use this <code class="literal">low_info_content</code> function in a detector in your anomaly detection job,
it models information content that is present in the message string for each
<code class="literal">logfilename</code>. It detects anomalies where the information content is low
compared to its past behavior. For example, this function detects unusually low
amounts of information in a collection of rolling log files. Low information
might indicate that a process has entered an infinite loop or that logging
features have been disabled.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-metric-functions"></a>Metric functions<a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>The metric functions include functions such as mean, min and max. These values
are calculated for each bucket. Field values that cannot be converted to
double precision floating point numbers are ignored.</p>
<p>The machine learning features include the following metric functions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-metric-min" title="Min"><code class="literal">min</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-metric-max" title="Max"><code class="literal">max</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-metric-median" title="Median, high_median, low_median"><code class="literal">median</code>, <code class="literal">high_median</code>, <code class="literal">low_median</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-metric-mean" title="Mean, high_mean, low_mean"><code class="literal">mean</code>, <code class="literal">high_mean</code>, <code class="literal">low_mean</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-metric-metric" title="Metric"><code class="literal">metric</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-metric-varp" title="Varp, high_varp, low_varp"><code class="literal">varp</code>, <code class="literal">high_varp</code>, <code class="literal">low_varp</code></a>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot add rules with conditions to detectors that use the <code class="literal">metric</code>
function.</p>
</div>
</div>
<h5><a id="ml-metric-min"></a>Min</h5>
<p>The <code class="literal">min</code> function detects anomalies in the arithmetic minimum of a value.
The minimum value is calculated for each bucket.</p>
<p>High- and low-sided functions are not applicable.</p>
<p>This function supports the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 1: Analyzing minimum transactions with the min function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "min",
  "field_name" : "amt",
  "by_field_name" : "product"
}</pre>
</div>
<p>If you use this <code class="literal">min</code> function in a detector in your anomaly detection job, it detects
where the smallest transaction is lower than previously observed. You can use
this function to detect items for sale at unintentionally low prices due to data
entry mistakes. It models the minimum amount for each product over time.</p>
<h5><a id="ml-metric-max"></a>Max</h5>
<p>The <code class="literal">max</code> function detects anomalies in the arithmetic maximum of a value.
The maximum value is calculated for each bucket.</p>
<p>High- and low-sided functions are not applicable.</p>
<p>This function supports the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 2: Analyzing maximum response times with the max function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "max",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">max</code> function in a detector in your anomaly detection job, it detects
where the longest <code class="literal">responsetime</code> is longer than previously observed. You can use
this function to detect applications that have <code class="literal">responsetime</code> values that are
unusually lengthy. It models the maximum <code class="literal">responsetime</code> for each application
over time and detects when the longest <code class="literal">responsetime</code> is unusually long compared
to previous applications.</p>
<p><strong>Example 3: Two detectors with max and high_mean functions.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "max",
  "field_name" : "responsetime",
  "by_field_name" : "application"
},
{
  "function" : "high_mean",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>The analysis in the previous example can be performed alongside <code class="literal">high_mean</code>
functions by application. By combining detectors and using the same influencer
this job can detect both unusually long individual response times and average
response times for each bucket.</p>
<h5><a id="ml-metric-median"></a>Median, high_median, low_median</h5>
<p>The <code class="literal">median</code> function detects anomalies in the statistical median of a value.
The median value is calculated for each bucket.</p>
<p>If you want to monitor unusually high median values, use the <code class="literal">high_median</code>
function.</p>
<p>If you are just interested in unusually low median values, use the <code class="literal">low_median</code>
function.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 4: Analyzing response times with the median function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "median",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">median</code> function in a detector in your anomaly detection job, it models
the median <code class="literal">responsetime</code> for each application over time. It detects when the
median <code class="literal">responsetime</code> is unusual compared to previous <code class="literal">responsetime</code> values.</p>
<h5><a id="ml-metric-mean"></a>Mean, high_mean, low_mean</h5>
<p>The <code class="literal">mean</code> function detects anomalies in the arithmetic mean of a value.
The mean value is calculated for each bucket.</p>
<p>If you want to monitor unusually high average values, use the <code class="literal">high_mean</code>
function.</p>
<p>If you are just interested in unusually low average values, use the <code class="literal">low_mean</code>
function.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 5: Analyzing response times with the mean function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "mean",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">mean</code> function in a detector in your anomaly detection job, it models
the mean <code class="literal">responsetime</code> for each application over time. It detects when the mean
<code class="literal">responsetime</code> is unusual compared to previous <code class="literal">responsetime</code> values.</p>
<p><strong>Example 6: Analyzing response times with the high_mean function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "high_mean",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">high_mean</code> function in a detector in your anomaly detection job, it
models the mean <code class="literal">responsetime</code> for each application over time. It detects when
the mean <code class="literal">responsetime</code> is unusually high compared to previous <code class="literal">responsetime</code>
values.</p>
<p><strong>Example 7: Analyzing response times with the low_mean function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "low_mean",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">low_mean</code> function in a detector in your anomaly detection job, it
models the mean <code class="literal">responsetime</code> for each application over time. It detects when
the mean <code class="literal">responsetime</code> is unusually low compared to previous <code class="literal">responsetime</code>
values.</p>
<h5><a id="ml-metric-metric"></a>Metric</h5>
<p>The <code class="literal">metric</code> function combines <code class="literal">min</code>, <code class="literal">max</code>, and <code class="literal">mean</code> functions. You can use
it as a shorthand for a combined analysis. If you do not specify a function in
a detector, this is the default function.</p>
<p>High- and low-sided functions are not applicable. You cannot use this function
when a <code class="literal">summary_count_field_name</code> is specified.</p>
<p>This function supports the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 8: Analyzing response times with the metric function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "metric",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">metric</code> function in a detector in your anomaly detection job, it models
the mean, min, and max <code class="literal">responsetime</code> for each application over time. It detects
when the mean, min, or max <code class="literal">responsetime</code> is unusual compared to previous
<code class="literal">responsetime</code> values.</p>
<h5><a id="ml-metric-varp"></a>Varp, high_varp, low_varp</h5>
<p>The <code class="literal">varp</code> function detects anomalies in the variance of a value which is a
measure of the variability and spread in the data.</p>
<p>If you want to monitor unusually high variance, use the <code class="literal">high_varp</code> function.</p>
<p>If you are just interested in unusually low variance, use the <code class="literal">low_varp</code> function.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 9: Analyzing response times with the varp function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "varp",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">varp</code> function in a detector in your anomaly detection job, it models
the variance in values of <code class="literal">responsetime</code> for each application over time. It
detects when the variance in <code class="literal">responsetime</code> is unusual compared to past
application behavior.</p>
<p><strong>Example 10: Analyzing response times with the high_varp function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "high_varp",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">high_varp</code> function in a detector in your anomaly detection job, it
models the variance in values of <code class="literal">responsetime</code> for each application over time.
It detects when the variance in <code class="literal">responsetime</code> is unusual compared to past
application behavior.</p>
<p><strong>Example 11: Analyzing response times with the low_varp function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "low_varp",
  "field_name" : "responsetime",
  "by_field_name" : "application"
}</pre>
</div>
<p>If you use this <code class="literal">low_varp</code> function in a detector in your anomaly detection job, it
models the variance in values of <code class="literal">responsetime</code> for each application over time.
It detects when the variance in <code class="literal">responsetime</code> is unusual compared to past
application behavior.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-rare-functions"></a>Rare functions<a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>The rare functions detect values that occur rarely in time or rarely for a
population.</p>
<p>The <code class="literal">rare</code> analysis detects anomalies according to the number of distinct rare
values. This differs from <code class="literal">freq_rare</code>, which detects anomalies according to the
number of times (frequency) rare values occur.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">rare</code> and <code class="literal">freq_rare</code> functions should not be used in conjunction with
<code class="literal">exclude_frequent</code>.
</li>
<li class="listitem">
You cannot create forecasts for anomaly detection jobs that contain <code class="literal">rare</code> or
<code class="literal">freq_rare</code> functions.
</li>
<li class="listitem">
You cannot add rules with conditions to detectors that use <code class="literal">rare</code> or
<code class="literal">freq_rare</code> functions.
</li>
<li class="listitem">
Shorter bucket spans (less than 1 hour, for example) are recommended when
looking for rare events. The functions model whether something happens in a
bucket at least once. With longer bucket spans, it is more likely that
entities will be seen in a bucket and therefore they appear less rare.
Picking the ideal bucket span depends on the characteristics of the data
with shorter bucket spans typically being measured in minutes, not hours.
</li>
<li class="listitem">
To model rare data, a learning period of at least 20 buckets is required
for typical data.
</li>
</ul>
</div>
</div>
</div>
<p>The machine learning features include the following rare functions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-rare" title="Rare"><code class="literal">rare</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-freq-rare" title="Freq_rare"><code class="literal">freq_rare</code></a>
</li>
</ul>
</div>
<h5><a id="ml-rare"></a>Rare</h5>
<p>The <code class="literal">rare</code> function detects values that occur rarely in time or rarely for a
population. It detects anomalies according to the number of distinct rare values.</p>
<p>This function supports the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">by_field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 1: Analyzing status codes with the rare function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "rare",
  "by_field_name" : "status"
}</pre>
</div>
<p>If you use this <code class="literal">rare</code> function in a detector in your anomaly detection job, it detects
values that are rare in time. It models status codes that occur over time and
detects when rare status codes occur compared to the past. For example, you can
detect status codes in a web access log that have never (or rarely) occurred
before.</p>
<p><strong>Example 2: Analyzing status codes in a population with the rare function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "rare",
  "by_field_name" : "status",
  "over_field_name" : "clientip"
}</pre>
</div>
<p>If you use this <code class="literal">rare</code> function in a detector in your anomaly detection job, it detects
values that are rare in a population. It models status code and client IP
interactions that occur. It defines a rare status code as one that occurs for
few client IP values compared to the population. It detects client IP values
that experience one or more distinct rare status codes compared to the
population. For example in a web access log, a <code class="literal">clientip</code> that experiences the
highest number of different rare status codes compared to the population is
regarded as highly anomalous. This analysis is based on the number of different
status code values, not the count of occurrences.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To define a status code as rare the machine learning features look at the number
of distinct status codes that occur, not the number of times the status code
occurs. If a single client IP experiences a single unique status code, this
is rare, even if it occurs for that client IP in every bucket.</p>
</div>
</div>
<h5><a id="ml-freq-rare"></a>Freq_rare</h5>
<p>The <code class="literal">freq_rare</code> function detects values that occur rarely for a population.
It detects anomalies according to the number of times (frequency) that rare
values occur.</p>
<p>This function supports the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">by_field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 3: Analyzing URI values in a population with the freq_rare function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "freq_rare",
  "by_field_name" : "uri",
  "over_field_name" : "clientip"
}</pre>
</div>
<p>If you use this <code class="literal">freq_rare</code> function in a detector in your anomaly detection job, it
detects values that are frequently rare in a population. It models URI paths and
client IP interactions that occur. It defines a rare URI path as one that is
visited by few client IP values compared to the population. It detects the
client IP values that experience many interactions with rare URI paths compared
to the population. For example in a web access log, a client IP that visits
one or more rare URI paths many times compared to the population is regarded as
highly anomalous. This analysis is based on the count of interactions with rare
URI paths, not the number of different URI path values.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Defining a URI path as rare happens the same way as you can see in the
case of the status codes above: the analytics consider the number of distinct
values that occur and not the number of times the URI path occurs. If a single
client IP visits a single unique URI path, this is rare, even if it
occurs for that client IP in every bucket.</p>
</div>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-sum-functions"></a>Sum functions<a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>The sum functions detect anomalies when the sum of a field in a bucket is
anomalous.</p>
<p>If you want to monitor unusually high totals, use high-sided functions.</p>
<p>If want to look at drops in totals, use low-sided functions.</p>
<p>If your data is sparse, use <code class="literal">non_null_sum</code> functions. Buckets without values are
ignored; buckets with a zero value are analyzed.</p>
<p>The machine learning features include the following sum functions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-sum" title="Sum, high_sum, low_sum"><code class="literal">sum</code>, <code class="literal">high_sum</code>, <code class="literal">low_sum</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-nonnull-sum" title="Non_null_sum, high_non_null_sum, low_non_null_sum"><code class="literal">non_null_sum</code>, <code class="literal">high_non_null_sum</code>, <code class="literal">low_non_null_sum</code></a>
</li>
</ul>
</div>
<h5><a id="ml-sum"></a>Sum, high_sum, low_sum</h5>
<p>The <code class="literal">sum</code> function detects anomalies where the sum of a field in a bucket is
anomalous.</p>
<p>If you want to monitor unusually high sum values, use the <code class="literal">high_sum</code> function.</p>
<p>If you want to monitor unusually low sum values, use the <code class="literal">low_sum</code> function.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 1: Analyzing total expenses with the sum function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "sum",
  "field_name" : "expenses",
  "by_field_name" : "costcenter",
  "over_field_name" : "employee"
}</pre>
</div>
<p>If you use this <code class="literal">sum</code> function in a detector in your anomaly detection job, it
models total expenses per employees for each cost center. For each time bucket,
it detects when an employee’s expenses are unusual for a cost center compared
to other employees.</p>
<p><strong>Example 2: Analyzing total bytes with the high_sum function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "high_sum",
  "field_name" : "cs_bytes",
  "over_field_name" : "cs_host"
}</pre>
</div>
<p>If you use this <code class="literal">high_sum</code> function in a detector in your anomaly detection job, it
models total <code class="literal">cs_bytes</code>. It detects <code class="literal">cs_hosts</code> that transfer unusually high
volumes compared to other <code class="literal">cs_hosts</code>. This example looks for volumes of data
transferred from a client to a server on the internet that are unusual compared
to other clients. This scenario could be useful to detect data exfiltration or
to find users that are abusing internet privileges.</p>
<h5><a id="ml-nonnull-sum"></a>Non_null_sum, high_non_null_sum, low_non_null_sum</h5>
<p>The <code class="literal">non_null_sum</code> function is useful if your data is sparse. Buckets without
values are ignored and buckets with a zero value are analyzed.</p>
<p>If you want to monitor unusually high totals, use the <code class="literal">high_non_null_sum</code>
function.</p>
<p>If you want to look at drops in totals, use the <code class="literal">low_non_null_sum</code> function.</p>
<p>These functions support the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_name</code> (required)
</li>
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Population analysis (that is to say, use of the <code class="literal">over_field_name</code> property)
is not applicable for this function.</p>
</div>
</div>
<p><strong>Example 3: Analyzing employee approvals with the high_non_null_sum function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "high_non_null_sum",
  "fieldName" : "amount_approved",
  "byFieldName" : "employee"
}</pre>
</div>
<p>If you use this <code class="literal">high_non_null_sum</code> function in a detector in your anomaly detection job,
it models the total <code class="literal">amount_approved</code> for each employee. It ignores any buckets
where the amount is null. It detects employees who approve unusually high
amounts compared to their past behavior.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-time-functions"></a>Time functions<a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>The time functions detect events that happen at unusual times, either of the day
or of the week. These functions can be used to find unusual patterns of behavior,
typically associated with suspicious user activity.</p>
<p>The machine learning features include the following time functions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-time-of-day" title="Time_of_day"><code class="literal">time_of_day</code></a>
</li>
<li class="listitem">
<a class="xref" href="ml-functions.html#ml-time-of-week" title="Time_of_week"><code class="literal">time_of_week</code></a>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
NOTE: You cannot create forecasts for anomaly detection jobs that contain time
functions.
</li>
<li class="listitem">
The <code class="literal">time_of_day</code> function is not aware of the difference between days, for
instance work days and weekends. When modeling different days, use the
<code class="literal">time_of_week</code> function. In general, the <code class="literal">time_of_week</code> function is more suited
to modeling the behavior of people rather than machines, as people vary their
behavior according to the day of the week.
</li>
<li class="listitem">
Shorter bucket spans (for example, 10 minutes) are recommended when performing
a <code class="literal">time_of_day</code> or <code class="literal">time_of_week</code> analysis. The time of the events being modeled
are not affected by the bucket span, but a shorter bucket span enables quicker
alerting on unusual events.
</li>
<li class="listitem">
Unusual events are flagged based on the previous pattern of the data, not on
what we might think of as unusual based on human experience. So, if events
typically occur between 3 a.m. and 5 a.m., an event occurring at 3 p.m. is
flagged as unusual.
</li>
<li class="listitem">
When Daylight Saving Time starts or stops, regular events can be flagged as
anomalous. This situation occurs because the actual time of the event (as
measured against a UTC baseline) has changed. This situation is treated as a
step change in behavior and the new times will be learned quickly.
</li>
</ul>
</div>
</div>
</div>
<h5><a id="ml-time-of-day"></a>Time_of_day</h5>
<p>The <code class="literal">time_of_day</code> function detects when events occur that are outside normal
usage patterns. For example, it detects unusual activity in the middle of the
night.</p>
<p>The function expects daily behavior to be similar. If you expect the behavior of
your data to differ on Saturdays compared to Wednesdays, the <code class="literal">time_of_week</code>
function is more appropriate.</p>
<p>This function supports the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 1: Analyzing events with the time_of_day function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "time_of_day",
  "by_field_name" : "process"
}</pre>
</div>
<p>If you use this <code class="literal">time_of_day</code> function in a detector in your anomaly detection job, it
models when events occur throughout a day for each process. It detects when an
event occurs for a process that is at an unusual time in the day compared to
its past behavior.</p>
<h5><a id="ml-time-of-week"></a>Time_of_week</h5>
<p>The <code class="literal">time_of_week</code> function detects when events occur that are outside normal
usage patterns. For example, it detects login events on the weekend.</p>
<p>This function supports the following properties:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">by_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">over_field_name</code> (optional)
</li>
<li class="listitem">
<code class="literal">partition_field_name</code> (optional)
</li>
</ul>
</div>
<p>For more information about those properties, see the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html#ml-put-job-request-body" class="ulink" target="_top">create anomaly detection jobs API</a>.</p>
<p><strong>Example 2: Analyzing events with the time_of_week function.</strong></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "function" : "time_of_week",
  "by_field_name" : "eventcode",
  "over_field_name" : "workstation"
}</pre>
</div>
<p>If you use this <code class="literal">time_of_week</code> function in a detector in your anomaly detection job, it
models when events occur throughout the week for each <code class="literal">eventcode</code>. It detects
when a workstation event occurs at an unusual time during the week for that
<code class="literal">eventcode</code> compared to other workstations. It detects events for a
particular workstation that are outside the normal usage pattern.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="kibana-apis.html">« Kibana APIs</a>
</span>
<span class="next">
<a href="ml-modules.html">Machine learning modules »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
